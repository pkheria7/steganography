from PIL import Image
from common import message_to_binary, binary_to_message
from encrypt import dfs_encryption
from decrypt import dfs_decryption
from config import get_depth_limit, get_height, get_width, get_password
import random

def get_message():
    return "The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs. Each step carried a memory, a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs.The stars blinked above, silent witnesses to dreams whispered in the dark.a story untold, wrapped in moonlight and stitched with longing.The stars blinked above, silent witnesses to dreams whispered in the dark. She wandered far, chasing echoes of hope and fragments of forgotten songs."

def divide_message(message, packet_length):
    return [message[i:i + packet_length] for i in range(0, len(message), packet_length)]

def generate_starting_points(number, length):
    start_points = []
    random.seed(23)
    for _ in range(number):
        while True:
            x = random.randint(5, 1000)
            y = random.randint(5, 1000)
            if not start_points:  # First point
                start_points.append((x, y))
                break
            valid = True
            for px, py in start_points:
                if abs(x - px) + abs(y - py) <= length:
                    valid = False
                    break
            if valid:
                start_points.append((x, y))
                break
    return start_points

if __name__ == "__main__":
    img = Image.open("/Users/piyushkheria/Desktop/steganography/test.png").convert("RGBA")
    width, height = img.size
    get_width(width)
    get_height(height)
    pixels = img.load()

    message = get_message()
    packet_length = 60  # Divide into packets
    packets = divide_message(message, packet_length)
    check_point = get_password("hello")
    depth = packet_length
    get_depth_limit(depth)

    start_points = generate_starting_points(len(packets), packet_length)

    visited = set()
    path = []
    additonal = 0
    for i in range (len(packets)):
        data_index = 0
        enc_msg = message_to_binary(packets[i])
        start_x, start_y = start_points[i+additonal]
        while (start_x,start_y) in visited:
            additonal += 1
            start_x, start_y = start_points[i+additonal]
        data_index = dfs_encryption(start_x, start_y, enc_msg, pixels, visited, path, data_index)
        data_index = 0

    img.save("graph_based_hashing.png")
    
    print("Encryption done." , end="\n\n")

    # Decryption
    img = Image.open("graph_based_hashing.png").convert("RGBA")
    width, height = img.size
    pixels = img.load()
    visited = set()
    path = []
    final_message=""
    additonal=0
    for i in range(len(packets)):
        start_x, start_y = start_points[i+additonal]
        while (start_x,start_y) in visited:
            additonal += 1
            start_x, start_y = start_points[i+additonal]
        message_extraction = ""
        message_extraction = dfs_decryption(start_x, start_y, pixels, visited, path, message_extraction,8*packet_length)
        final_message += binary_to_message(message_extraction)
    print("Decryptic message is :", final_message)

    count = 0
    print(len(message)-len(final_message))
    for i in range(len(message)):
        if message[i] != final_message[i]:
            count+=1
    print(count)
